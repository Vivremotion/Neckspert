var At=Object.defineProperty;var Ot=(e,t,r)=>t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var K=(e,t,r)=>Ot(e,typeof t!="symbol"?t+"":t,r);import{a as P,n as rt,t as A,d as _t,e as kt}from"../chunks/d_A3s8Hn.js";import{i as Q}from"../chunks/_dtghID2.js";import{E as Ht,aM as Lt,aN as Ut,V as Gt,v as $t,P as yt,aO as Bt,X as Vt,n as nt,aP as Wt,ax as wt,a2 as It,an as jt,aa as zt,W as Jt,h as Qt,T as Xt,aQ as Et,B as X,aR as z,l as w,y as ot,j as o,aS as Tt,G as y,J as M,D,I as k,F as Y,aT as N,a8 as ct,C as Ct,aU as Yt,i as gt,aV as Kt}from"../chunks/De5FDGKC.js";import{i as U,s as vt,a as dt}from"../chunks/DtczuDqk.js";import{a as Zt,l as te,s as G,e as E}from"../chunks/BYklluxY.js";import{s as I,e as Z,i as tt,r as ee,k as re}from"../chunks/DVIbo4UV.js";import{p as it,b as se}from"../chunks/Ckwdi1fM.js";function lt(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}const ae=()=>performance.now(),J={tick:e=>requestAnimationFrame(e),now:()=>ae(),tasks:new Set};function Mt(){const e=J.now();J.tasks.forEach(t=>{t.c(e)||(J.tasks.delete(t),t.f())}),J.tasks.size!==0&&J.tick(Mt)}function ne(e){let t;return J.tasks.size===0&&J.tick(Mt),{promise:new Promise(r=>{J.tasks.add(t={c:e,f:r})}),abort(){J.tasks.delete(t)}}}function Pt(e,t){e.dispatchEvent(new CustomEvent(t))}function oe(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function St(e){const t={},r=e.split(";");for(const s of r){const[a,n]=s.split(":");if(!a||n===void 0)break;const i=oe(a.trim());t[i]=n.trim()}return t}const ie=e=>e;function le(e,t,r,s){var a=(e&Wt)!==0,n="in",i,h=t.inert,g=t.style.overflow,l,f;function m(){var u=jt,_=yt;wt(null),It(null);try{return i??(i=r()(t,(s==null?void 0:s())??{},{direction:n}))}finally{wt(u),It(_)}}var C={is_global:a,in(){t.inert=h,l==null||l.abort(),Pt(t,"introstart"),l=qt(t,m(),f,1,()=>{Pt(t,"introend"),l==null||l.abort(),l=i=void 0,t.style.overflow=g})},out(u){{u==null||u(),i=void 0;return}},stop:()=>{l==null||l.abort()}},p=yt;if((p.transitions??(p.transitions=[])).push(C),Zt){var v=a;if(!v){for(var c=p.parent;c&&c.f&Ht;)for(;(c=c.parent)&&!(c.f&Lt););v=!c||(c.f&Ut)!==0}v&&Gt(()=>{$t(()=>C.in())})}}function qt(e,t,r,s,a){if(Bt(t)){var n,i=!1;return Vt(()=>{if(!i){var c=t({direction:"in"});n=qt(e,c,r,s,a)}}),{abort:()=>{i=!0,n==null||n.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(!(t!=null&&t.duration))return a(),{abort:nt,deactivate:nt,reset:nt,t:()=>s};const{delay:h=0,css:g,tick:l,easing:f=ie}=t;var m=[];if(l&&l(0,1),g){var C=St(g(0,1));m.push(C,C)}var p=()=>1-s,v=e.animate(m,{duration:h});return v.onfinish=()=>{var c=1-s,u=s-c,_=t.duration*Math.abs(u),$=[];if(_>0){var H=!1;if(g)for(var B=Math.ceil(_/16.666666666666668),S=0;S<=B;S+=1){var T=c+u*f(S/B),L=St(g(T,1-T));$.push(L),H||(H=L.overflow==="hidden")}H&&(e.style.overflow="hidden"),p=()=>{var V=v.currentTime;return c+u*f(V/_)},l&&ne(()=>{if(v.playState!=="running")return!1;var V=p();return l(V,1-V),!0})}v=e.animate($,{duration:_,fill:"forwards"}),v.onfinish=()=>{p=()=>s,l==null||l(s,1-s),a()}},{abort:()=>{v&&(v.cancel(),v.effect=null,v.onfinish=nt)},deactivate:()=>{a=nt},reset:()=>{},t:()=>p()}}function ce(e,t,r=t){var s=zt();te(e,"input",a=>{var n=a?e.defaultValue:e.value;if(n=mt(e)?pt(n):n,r(n),s&&n!==(n=t())){var i=e.selectionStart,h=e.selectionEnd;e.value=n??"",h!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(h,e.value.length))}}),(Qt&&e.defaultValue!==e.value||$t(t)==null&&e.value)&&r(mt(e)?pt(e.value):e.value),Jt(()=>{var a=t();mt(e)&&a===pt(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function mt(e){var t=e.type;return t==="number"||t==="range"}function pt(e){return e===""?null:+e}function de(e){return function(...t){var r=t[0];return r.preventDefault(),e==null?void 0:e.apply(this,t)}}function fe(e,t){var n;var r=(n=e.$$events)==null?void 0:n[t.type],s=Xt(r)?r.slice():r==null?[]:[r];for(var a of s)a.call(this,t)}const ve=(e,t)=>{const r=Et(t),s=localStorage.getItem(e);return s!=null&&r.set(JSON.parse(s)),r.subscribe(a=>{a?localStorage.setItem(e,JSON.stringify(a)):localStorage.removeItem(e)}),r};function ue(){const{subscribe:e,update:t}=ve("chordsState",{chords:[]});return{subscribe:e,addChord:r=>{const s={...r,id:crypto.randomUUID()};t(a=>({...a,currentChord:s,currentChordIndex:a.chords.length-1,chords:[...a.chords,s]}))},removeChord:r=>{t(s=>{var n,i;const a=s.chords.filter(h=>h.id!==r);return{...s,currentChord:((n=s.currentChord)==null?void 0:n.id)!==r?s.currentChord:a.at(-1),currentChordIndex:((i=s.currentChord)==null?void 0:i.id)!==r?s.currentChordIndex:a.length-1,chords:a}})},reorderChords:(r,s)=>{t(a=>{const n=[...a.chords],[i]=n.splice(r,1);return n.splice(s,0,i),{...a,chords:n}})},setCurrentChord(r){t(s=>({...s,currentChord:s.chords.find(a=>a.id===r),currentChordIndex:s.chords.findIndex(a=>a.id===r)}))}}}const et=ue(),he=[{position:"C",relativeFret:0,notes:[{string:5,fret:3,finger:3},{string:4,fret:2,finger:2},{string:3,fret:0},{string:2,fret:1,finger:1},{string:1,fret:0}]},{position:"A",relativeFret:0,notes:[{string:6,fret:0},{string:5,fret:0},{string:4,fret:2,finger:2},{string:3,fret:2,finger:3},{string:2,fret:2,finger:4},{string:1,fret:0}]},{position:"G",relativeFret:0,notes:[{string:6,fret:3},{string:5,fret:2},{string:4,fret:0},{string:3,fret:0},{string:2,fret:3},{string:1,fret:3}]},{position:"E",relativeFret:0,notes:[{string:6,fret:0},{string:5,fret:2},{string:4,fret:2},{string:3,fret:1},{string:2,fret:0},{string:1,fret:0}]},{position:"D",relativeFret:0,notes:[{string:4,fret:0},{string:3,fret:2},{string:2,fret:3},{string:1,fret:2}]}],ge=[{position:"C",relativeFret:0,notes:[{string:5,fret:3,finger:4},{string:4,fret:1,finger:2},{string:3,fret:0},{string:2,fret:1,finger:1},{string:1,fret:3}]},{position:"A",relativeFret:0,notes:[{string:6,fret:0},{string:5,fret:0},{string:4,fret:2,finger:2},{string:3,fret:2,finger:3},{string:2,fret:1,finger:1},{string:1,fret:0}]},{position:"G",relativeFret:0,notes:[{string:6,fret:3},{string:5,fret:1},{string:4,fret:0},{string:3,fret:3},{string:2,fret:3},{string:1,fret:3}]},{position:"E",relativeFret:0,notes:[{string:6,fret:0},{string:5,fret:2},{string:4,fret:2},{string:3,fret:0},{string:2,fret:0},{string:1,fret:0}]},{position:"D",relativeFret:0,notes:[{string:4,fret:0},{string:3,fret:2},{string:2,fret:3},{string:1,fret:1}]}],me=[{position:"F",relativeFret:1,notes:[{string:6,fret:4},{string:5,fret:3},{string:4,fret:1},{string:3,fret:2}]},{position:"A#",relativeFret:0,notes:[{string:5,fret:1},{string:4,fret:0},{string:3,fret:1},{string:2,fret:2}]},{position:"D#",relativeFret:1,notes:[{string:4,fret:4},{string:3,fret:3},{string:2,fret:2},{string:1,fret:3}]}],pe=[{suffix:"",patterns:he},{suffix:"m",patterns:ge},{suffix:"7(#9)",patterns:me}],xe={0:"R",1:"m2",2:"M2",3:"m3",4:"3",5:"4",6:"TT",7:"5",8:"m6",9:"M6",10:"7",11:"M7"},at=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Nt(e,t){const r=at.indexOf(e);return(at.indexOf(t)-r+12)%12}function Dt(e,t){return xe[Nt(e,t)]}function _e(e,t){const s=(at.indexOf(e)+t)%12;return at[s]}function Ce(e){const t=[],r=["E","A","D","G","B","E"];return pe.forEach(s=>{s.patterns.forEach(a=>{const i=Nt(a.position,e)+a.relativeFret,h=a.notes.map(g=>{const l=(g.fret+i)%12,f=r[6-g.string],m=_e(f,l);return{...g,fret:l,name:m}});t.push({id:`${e}${s.suffix}-${a.position}`,root:e,quality:s.suffix,voicing:a.position,hpcp:at.sort().map(g=>+h.map(l=>l.name).includes(g)),notes:h})})}),t}function be(e){if(!e)return[];const t=e.toUpperCase();return at.filter(s=>s.toUpperCase().startsWith(t)).flatMap(s=>Ce(s))}var ke=rt('<text class="fret-number text-xl fill-slate-800 dark:fill-slate-300 svelte-rk85bq"> </text>'),ye=rt('<line class="string stroke-slate-800 dark:stroke-slate-300 svelte-rk85bq"></line>'),we=rt('<line class="fret stroke-slate-800 dark:stroke-slate-300 svelte-rk85bq"></line>'),Ie=rt('<text class="muted text-2xl fill-slate-800 dark:fill-slate-300 svelte-rk85bq">×</text>'),Pe=rt('<g><circle class="open-string fill-transparent stroke-2 stroke-slate-800 dark:stroke-slate-300 svelte-rk85bq"></circle><text class="note-name text-l fill-slate-800 dark:fill-slate-300 svelte-rk85bq"> </text></g>'),Se=rt('<g><circle class="fretted-note fill-slate-800 dark:fill-slate-300 svelte-rk85bq"></circle><text class="note-name fill-slate-300 dark:fill-slate-800 svelte-rk85bq"> </text></g>'),De=rt('<text class="finger-number text-xl fill-slate-800 dark:fill-slate-300 svelte-rk85bq"> </text>'),Fe=rt('<svg class="svelte-rk85bq"><!><!><!><!><!><!><!></svg>');function Rt(e,t){X(t,!1);const r=N(),s=N(),a=N(),n=N(),i=N(),h=N(),g=N();let l=it(t,"chord",8);const f=240,m=260,C=30,p=45,v=40,c=45,u=12;let _=N(null);function $(x){return c+(6-x)*C}function H(x){const d=x-o(s);return v+d*p+(o(s)===0?-45/2:p/2)}function B(x){return x.name===l().root}z(()=>ot(l()),()=>{w(r,l().notes.filter(x=>x.fret>0))}),z(()=>ot(l()),()=>{w(s,Math.min(...l().notes.map(x=>x.fret||0)))}),z(()=>ot(l()),()=>{w(a,Math.max(...l().notes.map(x=>x.fret||0)))}),z(()=>(o(a),o(s)),()=>{w(n,o(a)-o(s))}),z(()=>o(n),()=>{w(i,Math.max(4,o(n)))}),z(()=>ot(l()),()=>{w(h,[1,2,3,4,5,6].filter(x=>!l().notes.some(d=>d.string===x)))}),z(()=>ot(l()),()=>{w(g,l().notes.filter(x=>!x.fret))}),Tt(),Q();var S=Fe();I(S,"width",f),I(S,"height",m);var T=y(S);{var L=x=>{var d=ke();I(d,"x",c/2),I(d,"y",v+p/2);var b=y(d,!0);k(d),D(()=>G(b,o(s))),P(x,d)};U(T,x=>{o(s)>0&&x(L)})}var V=M(T);Z(V,0,()=>Array(6),tt,(x,d,b)=>{var F=ye();D(()=>I(F,"x1",$(b+1))),I(F,"y1",v),D(()=>I(F,"x2",$(b+1))),D(()=>I(F,"y2",v+o(i)*p)),P(x,F)});var q=M(V);Z(q,1,()=>Array(o(i)+1),tt,(x,d,b)=>{var F=we();D(()=>I(F,"x1",$(6))),I(F,"y1",v+b*p),D(()=>I(F,"x2",$(1))),I(F,"y2",v+b*p),D(()=>lt(F,"nut",o(s)===0&&b===0)),P(x,F)});var R=M(q);Z(R,1,()=>o(h),tt,(x,d)=>{var b=Ie();D(()=>I(b,"x",$(o(d)))),I(b,"y",v/2),P(x,b)});var W=M(R);Z(W,1,()=>o(g),tt,(x,d)=>{var b=Pe(),F=y(b);D(()=>I(F,"cx",$(o(d).string))),I(F,"cy",v/2),I(F,"r",u);const ut=ct(()=>B(o(d)));var j=M(F);D(()=>I(j,"x",$(o(d).string))),I(j,"y",v/2);var ht=y(j,!0);D(()=>{var bt;return G(ht,((bt=o(_))==null?void 0:bt.string)===o(d).string?Dt(l().root,o(_).name):o(d).name)}),k(j),k(b),D(()=>lt(F,"root",o(ut))),E("mouseenter",b,()=>w(_,o(d))),E("mouseleave",b,()=>w(_,null)),P(x,b)});var ft=M(W);Z(ft,1,()=>o(r),tt,(x,d)=>{var b=Se(),F=y(b);D(()=>I(F,"cx",$(o(d).string))),D(()=>I(F,"cy",H(o(d).fret))),I(F,"r",u);const ut=ct(()=>B(o(d)));var j=M(F);D(()=>I(j,"x",$(o(d).string))),D(()=>I(j,"y",H(o(d).fret)));var ht=y(j,!0);D(()=>G(ht,o(_)===o(d)?Dt(l().root,o(d).name):o(d).name)),k(j),k(b),D(()=>lt(F,"root",o(ut))),E("mouseenter",b,()=>w(_,o(d))),E("mouseleave",b,()=>w(_,null)),P(x,b)});var st=M(ft);Z(st,1,()=>l().notes.filter(x=>x.finger!==void 0&&x.fret!==0),tt,(x,d)=>{var b=De();D(()=>I(b,"x",$(o(d).string)));var F=y(b,!0);k(b),D(()=>{I(b,"y",v*1.5+o(i)*p),G(F,o(d).finger)}),P(x,b)}),k(S),P(e,S),Y()}var $e=A('<div class="dropdown-item no-results dark:text-slate-300 svelte-gsktqk">No results found</div>'),Ee=A(`<div class="dropdown-item
            border-none ring-0
            hover:bg-slate-300
            bg-slate-100 dark:bg-slate-600
            dark:text-slate-200 dark:hover:bg-slate-700 svelte-gsktqk" role="option"> </div>`),Te=A('<div class="preview bg-slate-100 dark:bg-slate-600 absolute top-52"><!></div>'),Me=A('<div class="results-container bg-slate-200 shadow-md shadow-slate-200 dark:shadow-slate-700" role="listbox"><div class="chord-list svelte-gsktqk"><!></div> <!></div>'),qe=A(`<div class="search-container font-extralight svelte-gsktqk"><input type="text" placeholder="Search a chord" class="search-input
      border-0 border-b-2
      font-light text-slate-400 focus:ring-0
      dark:bg-slate-800
      dark:focus:border-slate-400 svelte-gsktqk" aria-controls="dropdown" role="combobox"> <!></div>`);function Ne(e,t){X(t,!1);const r=N();let s=N(""),a=N(!1),n=N(-1),i=N(),h=N(null);function g(_){w(s,""),w(a,!1),w(n,-1),et.addChord(_)}function l(_){w(h,_)}function f(){w(h,null)}function m(){w(a,!0)}function C(){w(a,!1),w(n,-1)}z(()=>o(s),()=>{w(r,be(o(s)))}),z(()=>o(r),()=>{o(r)&&w(n,-1)}),Tt(),Q();var p=qe(),v=y(p);ee(v);var c=M(v,2);{var u=_=>{var $=Me(),H=y($),B=y(H);{var S=q=>{var R=$e();P(q,R)},T=q=>{var R=_t(),W=Ct(R);Z(W,1,()=>o(r),tt,(ft,st,x)=>{var d=Ee();I(d,"tabindex",x);var b=y(d);k(d),D(()=>{I(d,"aria-selected",x===o(n)),lt(d,"selected",x===o(n)),G(b,`${o(st).root??""}${o(st).quality??""} (${o(st).voicing??""} shape)`)}),E("mouseenter",d,()=>l(o(st))),E("mouseleave",d,f),E("mousedown",d,()=>g(o(st))),P(ft,d)}),P(q,R)};U(B,q=>{o(r).length===0?q(S):q(T,!1)})}k(H);var L=M(H,2);{var V=q=>{var R=Te(),W=y(R);Rt(W,{get chord(){return o(h)}}),k(R),P(q,R)};U(L,q=>{o(h)&&q(V)})}k($),se($,q=>w(i,q),()=>o(i)),P(_,$)};U(c,_=>{o(a)&&o(r).length>0&&_(u)})}k(p),D(()=>I(v,"aria-expanded",o(a))),ce(v,()=>o(s),_=>w(s,_)),E("focus",v,m),E("blur",v,C),P(e,p),Y()}var Re=A('<div class="chord-displayer flex flex-col items-center"><h2 class="text-slate-800 dark:text-slate-300 font-serif text-3xl my-4"> </h2> <div class="info font-mono text-slate-800 dark:text-slate-300"> </div> <!></div>');function Ae(e,t){X(t,!1);let r=it(t,"chord",8);Q();var s=Re(),a=y(s),n=y(a);k(a);var i=M(a,2),h=y(i);k(i);var g=M(i,2);Rt(g,{get chord(){return r()}}),k(s),D(()=>{G(n,`${r().root??""}${r().quality??""}`),G(h,`(${r().voicing??""} shape)`)}),P(e,s),Y()}var Oe=A('<div class="separator bg-slate-400 svelte-52qip3"></div>'),He=A('<div class="chord-slot svelte-52qip3" role="listitem"><!> <!></div>'),Le=A('<div class="chord-container svelte-52qip3" role="list"></div>');function Ue(e,t){X(t,!1);const[r,s]=vt(),a=()=>dt(et,"$chordStore",r);let n=null;function i(m,C){m.preventDefault(),n=C}function h(m){var p;const C=parseInt(((p=m.dataTransfer)==null?void 0:p.getData("text/plain"))||"-1");n!==null&&C!==-1&&et.reorderChords(C,n),n=null}function g(){n=null}function l(m,C){m.preventDefault(),et.setCurrentChord(C)}Q();var f=Le();Z(f,5,()=>{var m;return(m=a())==null?void 0:m.chords},tt,(m,C,p)=>{let v=()=>o(C).id,c=()=>o(C).root,u=ct(()=>Yt(o(C).quality,""));var _=He(),$=y(_),H=ct(()=>c()+o(u));Ve($,{get id(){return v()},get name(){return o(H)},index:p});var B=M($,2);{var S=T=>{var L=Oe();P(T,L)};U(B,T=>{p<a().chords.length-1&&T(S)})}k(_),E("dragover",_,T=>i(T,p)),E("click",_,T=>l(T,v())),P(m,_)}),k(f),E("drop",f,h),E("dragover",f,de(function(m){fe.call(this,t,m)})),E("dragleave",f,g),P(e,f),Y(),s()}var Ge=A('<button class="remove-button text-xl font-thin dark:text-slate-200 dark:hover:text-slate-400 svelte-108ok40" aria-label="Remove chord">×</button>'),Be=A('<div class="chord-item hover:shadow-md hover:shadow-slate-200 dark:hover:shadow-slate-900 dark:bg-slate-600 svelte-108ok40" draggable="true" role="listitem"><span class="chord-value prose prose-xl font-mono font-light dark:text-slate-200"> </span> <!></div>');function Ve(e,t){X(t,!1);let r=it(t,"id",8,null),s=it(t,"name",8,""),a=it(t,"index",24,()=>-1),n=N(!1),i=N(!1);function h(c){var u;w(n,!0),(u=c.dataTransfer)==null||u.setData("text/plain",a().toString())}function g(){w(n,!1)}function l(c){c.stopPropagation(),et.removeChord(r())}Q();var f=Be(),m=y(f),C=y(m,!0);k(m);var p=M(m,2);{var v=c=>{var u=Ge();E("click",u,l),P(c,u)};U(p,c=>{o(i)&&c(v)})}k(f),D(()=>{lt(f,"dragging",o(n)),G(C,s())}),E("dragstart",f,h),E("dragend",f,g),E("mouseenter",f,()=>w(i,!0)),E("mouseleave",f,()=>w(i,!1)),P(e,f),Y()}function We(){const{subscribe:e,set:t,update:r}=Et({isPlaying:!1,countdown:0,score:0,timer:0});return{subscribe:e,reset:()=>{t({isPlaying:!1,countdown:5,score:0,timer:0})},updateTimer:s=>r(a=>({...a,timer:s})),updateCountdown:s=>r(a=>({...a,countdown:s})),setPlaying:s=>r(a=>({...a,isPlaying:s})),incrementScore:s=>r(a=>({...a,score:a.score+s}))}}const O=We(),je=""+new URL("../workers/detector-processor-5O3TsQI9.js",import.meta.url).href;class ze{constructor(){K(this,"audioContext",null);K(this,"stream",null);K(this,"onHPCPUpdateCallbacks",[])}async start(){try{if(this.audioContext&&this.stream)return console.error("[HPCPDetector]","Detection should already be running");this.audioContext=new AudioContext,this.stream=await navigator.mediaDevices.getUserMedia({audio:!0});const t=this.audioContext.createMediaStreamSource(this.stream);await this.audioContext.audioWorklet.addModule(new URL(je,import.meta.url));const r=new AudioWorkletNode(this.audioContext,"detector-processor",{processorOptions:{sampleRate:this.audioContext.sampleRate}}),s=this.audioContext.createGain();s.gain.setValueAtTime(0,this.audioContext.currentTime),t.connect(r),r.connect(s),s.connect(this.audioContext.destination),r.port.onmessage=a=>{this.onHPCPUpdateCallbacks.forEach(n=>n(a.data.hpcp))}}catch(t){throw console.error("Error detecting chords:",t),t}}pause(){var t;this.stream&&(this.stream.getTracks().forEach(r=>r.stop()),this.stream=null),(t=this.audioContext)==null||t.suspend()}subscribe(t){this.onHPCPUpdateCallbacks.push(t)}}const xt=new ze,Je=.85,Qe=.1;class Xe{constructor(){K(this,"expectedHPCP",Array(12));K(this,"chordsState");K(this,"countdownIntervalId",null);K(this,"timerIntervalId",null);et.subscribe(t=>{var r;this.chordsState=t,this.expectedHPCP=(r=t==null?void 0:t.currentChord)==null?void 0:r.hpcp}),xt.subscribe(this.onDetectedHPCP.bind(this))}async start(){this.chordsState.chords.length!==0&&(await xt.start(),O.reset(),O.setPlaying(!0),this.countdownIntervalId=setInterval(()=>{const t=gt(O).countdown;t===1&&(this.countdownIntervalId&&(clearInterval(this.countdownIntervalId),this.countdownIntervalId=null),this.setNextChord(0),this.startTimer()),O.updateCountdown(t-1)},1e3))}pause(){O.setPlaying(!1),this.timerIntervalId&&(clearInterval(this.timerIntervalId),this.timerIntervalId=null),this.countdownIntervalId&&(clearInterval(this.countdownIntervalId),this.countdownIntervalId=null,O.updateCountdown(0)),xt.pause()}onDetectedHPCP(t){if(!this.expectedHPCP)return;if(this.compareHPCP(this.expectedHPCP,t).isSimilar){const s=Math.max(0,5-gt(O).timer);O.incrementScore(Math.round(s)),this.setNextChord(),this.startTimer()}}setNextChord(t){const r=this.chordsState.chords[t]||this.chordsState.chords[this.chordsState.currentChordIndex+1]||this.chordsState.chords[0];et.setCurrentChord(r.id)}startTimer(){this.timerIntervalId&&clearInterval(this.timerIntervalId),O.updateTimer(0),this.timerIntervalId=setInterval(()=>{O.updateTimer(gt(O).timer+.01)},10)}compareHPCP(t,r,s={}){if(t.length!==r.length)throw new Error("HPCP profiles must have the same length");const{similarityThreshold:a=Je,differenceThreshold:n=Qe}=s,i=t.map((c,u)=>Math.abs(c-r[u])),h=i.reduce((c,u)=>c+u,0)/t.length,g=Math.max(...i),l=i.map((c,u)=>c>n?u:-1).filter(c=>c!==-1),f=t.reduce((c,u,_)=>c+u*r[_],0),m=Math.sqrt(t.reduce((c,u)=>c+u*u,0)),C=Math.sqrt(r.reduce((c,u)=>c+u*u,0)),p=f/(m*C),v=Math.sqrt(i.reduce((c,u)=>c+u*u,0)/t.length);return{isExactMatch:i.every(c=>c===0),isSimilar:p>=a,absoluteDifferences:i,averageDifference:h,maxDifference:g,significantDifferenceIndices:l,cosineSimilarity:p,rmsDifference:v}}}const Ft=new Xe;var Ye=A('<div class="play-commands svelte-2b4oh4" role="listitem"><button class="play-button text-5xl font-light hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 svelte-2b4oh4"><!></button></div>');function Ke(e,t){X(t,!1);let r=N(!1),s=N(!1);async function a(){o(s)?Ft.pause():Ft.start(),w(s,!o(s))}Q();var n=Ye(),i=y(n),h=y(i);{var g=f=>{var m=kt("| |");P(f,m)},l=f=>{var m=kt();D(()=>G(m,o(r)?"▶":"▷")),P(f,m)};U(h,f=>{o(s)?f(g):f(l,!1)})}k(i),k(n),E("mouseenter",i,()=>w(r,!0)),E("mouseleave",i,()=>w(r,!1)),E("click",i,a),P(e,n),Y()}var Ze=A('<div class="game-overlay flex flex-col items-center justify-center gap-y-10 text-5xl font-mono svelte-ull93e"><div class="timer"> </div> <div class="score"> </div></div>');function tr(e,t){X(t,!1);const[r,s]=vt(),a=()=>dt(O,"$gameStore",r);Q();var n=Ze(),i=y(n),h=y(i);D(()=>G(h,`${a().timer.toFixed(1)??""}s`)),k(i);var g=M(i,2),l=y(g);k(g),k(n),D(()=>G(l,`${a().score??""}pts`)),P(e,n),Y(),s()}function er(e){const t=e-1;return t*t*t+1}function rr(e,{delay:t=0,duration:r=400,easing:s=er,start:a=0,opacity:n=0}={}){const i=getComputedStyle(e),h=+i.opacity,g=i.transform==="none"?"":i.transform,l=1-a,f=h*(1-n);return{delay:t,duration:r,easing:s,css:(m,C)=>`
			transform: ${g} scale(${1-l*C});
			opacity: ${h-f*C}
		`}}function sr(e){return e===1?e:1-Math.pow(2,-10*e)}var ar=A('<span class="countdown-number text-slate-800 dark:text-slate-300 font-mono font-medium text-9xl"> </span>'),nr=A('<div class="countdown-container flex items-center justify-center svelte-ueih0b"><!></div>');function or(e,t){X(t,!1);const[r,s]=vt(),a=()=>dt(O,"$gameStore",r);Q();var n=_t(),i=Ct(n);{var h=g=>{var l=nr(),f=y(l);re(f,()=>a().countdown,m=>{var C=ar(),p=y(C,!0);k(C),D(()=>G(p,a().countdown)),le(1,C,()=>rr,()=>({duration:300,delay:0,opacity:.5,start:.4,easing:sr})),P(m,C)}),k(l),P(g,l)};U(i,g=>{a().countdown>0&&g(h)})}P(e,n),Y(),s()}var ir=A('<div class="app dark:bg-slate-800 svelte-1rn8ymw"><header><h1 class="title prose font-serif text-4xl dark:prose-invert">Neckspert</h1></header> <div class="top svelte-1rn8ymw"><!> <div class="flex items-center"><!> <!></div></div> <div class="bottom w-full h-full flex flex-row items-center"><div class="bottom-item svelte-1rn8ymw"><!></div> <div class="bottom-item svelte-1rn8ymw"><!></div> <div class="bottom-item svelte-1rn8ymw"></div></div></div>');function mr(e,t){X(t,!1);const[r,s]=vt(),a=()=>dt(et,"$chordStore",r),n=()=>dt(O,"$gameStore",r);Q();var i=ir(),h=M(y(i),2),g=y(h);Ne(g,{items:["C","Dm","Em","F","G","Am","Bdim"]});var l=M(g,2),f=y(l);Ue(f,{});var m=M(f,2);{var C=S=>{Ke(S,{})};U(m,S=>{var T,L;(L=(T=a())==null?void 0:T.chords)!=null&&L.length&&S(C)})}k(l),k(h);var p=M(h,2),v=y(p),c=y(v);{var u=S=>{tr(S,{class:"bottom-item"})};U(c,S=>{(n().score>0||n().isPlaying)&&S(u)})}k(v);var _=M(v,2),$=y(_);{var H=S=>{or(S,{})},B=S=>{var T=_t(),L=Ct(T);{var V=q=>{var R=ct(()=>{var W;return(W=a())==null?void 0:W.currentChord});Ae(q,{get chord(){return o(R)}})};U(L,q=>{var R;(R=a())!=null&&R.currentChord&&q(V)},!0)}P(S,T)};U($,S=>{n().countdown>0?S(H):S(B,!1)})}k(_),Kt(2),k(p),k(i),P(e,i),Y(),s()}export{mr as component};
